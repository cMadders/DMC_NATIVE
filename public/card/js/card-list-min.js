$(document).ready(function(){var l,d,r,o,n,e,i=0,c="http://www.digitalmediacommunications.com";function a(){window.parent.postMessage("dmc-get-card-dimensions","*");var e=window.innerHeight-109;$("#card-list").css("height",e),$("#card-detail").css("height",e)}function s(e){d&&d.addEvent("video_plays",e,function(e,a){e&&console.error("error logging beacon",e)}),r&&(e.url=c,e.id=window.DMC.Native.data._id,e.short_id=window.DMC.Native.data.short_id,e.publisher=window.DMC.Native.data.publisher,e.site=window.DMC.Native.data.site,e.name=window.DMC.Native.data.name,mixpanel.track("Video Play",e))}function w(e,a,t){"apply"==e&&(e="apply_here");var i=[a.toString(),e,"M1","native",window.DMC.Native.data.extra.dmc_publication_id,c];console.log("fireXUL_Beacon",i),o&&$.ajax({type:"POST",url:"http://widgets.digitalmediacommunications.com/analytics/clicks",data:{ci_csrf_token:o,data:JSON.stringify(i)},success:function(e){}})}function t(){$("#dmc-card-container").addClass("filter-menu-open")}function p(){a()}function m(){$("#card-header").css("position","fixed"),$("#dmc-card-container").removeClass("filter-menu-open"),a()}function v(){$("#card-header").css("position","absolute"),$("#card-list-filter").scrollTop(0);var e=window.innerWidth-70;TweenLite.to($("#card"),.3,{left:e+"px",onStart:t,onComplete:p,ease:Power1.easeOut})}function u(e){e=e||0,$("#dmc-card-container").removeClass("filter"),TweenLite.to($("#card"),.3,{left:"0",onComplete:m,ease:Power1.easeOut})}function h(e){$("#card-list .item").hide(),"all"!==e?($('.item[data-category="'+e+'"]').show(),$("#card").scrollTop(0),$("#card-list").scrollTop(0)):$(".item").show(),u(".3")}function f(){window.scrollTo(0,0),a(),$("html, body").addClass("disable-scroll");var e=window.innerWidth/1.77778;$("#clixie-video-player").attr("height",Math.round(e))}function y(){$("#card-detail").scrollTop(0),$("html, body").removeClass("disable-scroll"),$("#card-detail").css("display","none"),a(),$("html body").animate({scrollTop:i},300)}function C(){var e={};if(e.url=c,e.id=window.DMC.Native.data._id,e.short_id=window.DMC.Native.data.short_id,e.publisher=window.DMC.Native.data.publisher,e.site=window.DMC.Native.data.site,e.name=window.DMC.Native.data.name,l){var a=l.extra.clixie_vid_uuid&&"0"!==l.extra.clixie_vid_uuid?"Clixie":"DMC";e={id:l._id,listingID:l.extra.listingID,dmcAdNumber:l.extra.dmcAdNumber,headline:l.headline,tagline:l.tagline,category:l.category,vertical:l.vertical,website:l.link.website,referrer:document.referrer,type:"listing",videoType:a,keen:{timestamp:(new Date).toISOString()}}}else e={type:"ivb",referrer:document.referrer,keen:{timestamp:(new Date).toISOString()}};return e}function g(e,a,t,i){if(t?(l.vertical&&"employment"!=l.vertical.toLowerCase()&&$("#card-footer .apply p").text("Visit Website"),$("#card-footer .apply").show(),$("#card-footer .apply").attr("href",t),$("#card-footer").removeClass("reverse")):($("#card-footer .apply").hide(),$("#card-footer").addClass("reverse")),e){$("#card-footer .share").show();var d=encodeURIComponent(window.DMC.Native.data.publisher+": "+window.DMC.Native.data.headline+", "+e);a||(a=e),i&&(d="retail"==l.vertical.toLowerCase()||"real estate"==l.vertical.toLowerCase()?encodeURIComponent("Check out this video from "+i.advertiser+", "+a):encodeURIComponent(i.advertiser+" has an opening for "+i.tagline+"! Check out this video, "+a));var r="https://www.facebook.com/dialog/feed?app_id=484257678295938&display=popup&redirect_uri=";r=r+encodeURIComponent(e)+"&link="+encodeURIComponent(e)+"&caption="+encodeURIComponent(window.DMC.Native.data.publisher+": "+window.DMC.Native.data.headline),$("#card-footer .fb").attr("href",r),!i&&a&&(d=encodeURIComponent(window.DMC.Native.data.publisher+": "+window.DMC.Native.data.headline+", "+a));var o="https://twitter.com/intent/tweet?text=";o+=d,$("#card-footer .twitter").attr("href",o);var n="sms:&body="+d;"iOS"!=(c=navigator.userAgent||navigator.vendor||window.opera,/windows phone/i.test(c)?"windows":/android/i.test(c)?"android":/iPad|iPhone|iPod/.test(c)&&!window.MSStream?"iOS":"unknown")&&(n="sms:?body="+d),$("#card-footer .sms").attr("href",n)}else $("#card-footer .share").hide(),$("#card-footer").addClass("reverse");var c}$("#card-header .filter.category").click(function(e){e.preventDefault(),$("#dmc-card-container").toggleClass("filter"),$("#dmc-card-container").hasClass("filter")?v():u(".3")}),$("#card-header .close-card").click(function(e){e.preventDefault(),window.parent.postMessage("dmc-eject-card","*")}),$("#card-list-filter li").click(function(e){e.preventDefault(),$("#card-list-filter li").removeClass("active"),$(this).addClass("active"),h($(this).data("category"))}),$("#card-header .back").click(function(e){e.preventDefault(),document.getElementById("native-video-player")&&(document.getElementById("native-video-player").currentTime=0,document.getElementById("native-video-player").pause()),document.getElementById("clixie-video-player")&&$("#clixie-video-player").attr("src",""),$("#card-detail .coupon").hide(),$("#card-detail .address").hide(),$("#card-detail .map").hide(),l=null,$("#card-header .filter").show(),$("#card-header .back").hide(),$("#card-footer .apply").hide(),$("#card-footer").addClass("reverse"),g(window.DMC.Native.data.extra.dmc_index_url,window.DMC.Native.data.extra.dmc_index_url_short);var a=window.innerWidth;TweenLite.to($("#card-detail"),.5,{left:a,delay:0,onComplete:y,ease:Power1.easeOut})}),$("#card-footer a").click(function(e){var a=$(this).data("medium"),t="share_actions";"Apply"===a&&(t="apply_actions"),l&&w(a.toLowerCase(),l.extra.listingID),d&&l&&d.trackExternalLink(e,t,{creative:l,medium:a});var i=C();r&&(t="share_actions"==t?"Share":"Apply",i.medium=a,mixpanel.track(t,i))}),$("#card-list .item").click(function(e){if(e.preventDefault(),$("#dmc-card-container").hasClass("filter-menu-open"))return u();var t=$(this).data("id");$.each(DMC.Native.data.creatives_compiled,function(e,a){if(a._id===t)return l=a,!1}),i=document.body.scrollTop,function(){var e=$("#entry-template").html(),a=Handlebars.compile(e);l.extra.clixie_vid_uuid&&"0"!=l.extra.clixie_vid_uuid&&(l.isClixie=!0);var t=a(l);$("#entryOutput").html(t)}(),g(l.link.slp,l.link.slp_short,l.link.website,{advertiser:l.advertiser,tagline:l.tagline});TweenLite.to($("#card-detail"),.5,{left:"0",display:"block",delay:0,onComplete:f,ease:Power1.easeOut}),$("#card-header .filter").hide(),$("#card-header .back").css("display","flex");var a=C();s(a);a.videoType;w("video_play",a.listingID)}),$.get("//widgets.digitalmediacommunications.com/analytics/get_token",function(e){var a=JSON.parse(e);o=a.hash}),e=window.addEventListener?"addEventListener":"attachEvent",(0,window[e])("attachEvent"==e?"onmessage":"message",function(e){if("dmc-clixie-player-ready"===e.data.id){var a=l;a.id="dmc-init-clixie-player";var t=document.getElementById("clixie-video-player").contentWindow;t.postMessage(a,"*")}if("dmc-clixie-toast-clicked"===e.data.id){try{var i="clixie";n=C(),l&&w(i.toLowerCase(),l.extra.listingID),r&&(n.medium=i,mixpanel.track("Apply",n))}catch(e){console.error(e)}l&&l.link.website&&window.open(l.link.website)}if("dmc-clixie-video-play"===e.data.id)try{s(n=C()),w("video_play",n.listingID)}catch(e){console.error(e)}},!1),21<window.DMC.Native.data.creative_count?(v(),$("#dmc-card-container").addClass("filter")):h("all"),$("#card-list-filter li").removeClass("active"),$('#card-list-filter li[data-category="all"]').addClass("active"),g(window.DMC.Native.data.extra.dmc_index_url,window.DMC.Native.data.extra.dmc_index_url_short),a(),window.addEventListener("message",function(e){if(e.data.type&&"dmc-card-message"===e.data.type)switch(e.data.key){case"page_url":c=e.data.value,a=c,console.log("initMixPanel",a),r=!0,mixpanel.track("IVB Engaged",{url:a,id:window.DMC.Native.data._id,short_id:window.DMC.Native.data.short_id,publisher:window.DMC.Native.data.publisher,site:window.DMC.Native.data.site,name:window.DMC.Native.data.name})}var a},!1),window.addEventListener("resize",a),window.parent.postMessage("dmc-card-initialized","*"),TweenLite.to($("#dmc-card-container"),.5,{opacity:"1",ease:Power1.easeOut})});