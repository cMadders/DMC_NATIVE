$(document).ready(function(){function e(){l("all"),$("#card-list-filter li").removeClass("active"),$('#card-list-filter li[data-category="all"]').addClass("active"),p(window.DMC.Native.data.extra.dmc_index_url),a(),window.addEventListener("message",function(e){if(e.data.type&&"dmc-card-message"===e.data.type)switch(e.data.key){case"page_url":w=e.data.value,t(w)}},!1),window.addEventListener("resize",a),window.parent.postMessage("dmc-card-initialized","*"),TweenLite.to($("#dmc-card-container"),.5,{opacity:"1",ease:Power1.easeOut})}function a(){var e=window.innerHeight-109;$("#card-list").css("height",e),$("#card-detail").css("height",e)}function t(e){console.log("initKeenIO",e),v=new Keen({projectId:"56c1264e46f9a71a338f446c",writeKey:"936b2216b15acce7d3dd66337d00f30f57e9fdd9b9456b9a4c1609264c90258fc07bfa0dece818e776f1e541cab23eaa7481c3ace0405cc249b2ed5b22f37d6455057944a18b212a412143b19444f195312d3d038ea2877c4fcb34bc42a17ee3"});var a=function(a){var t={publisher:window.DMC.Native.data.publisher,site:window.DMC.Native.data.site,name:window.DMC.Native.data.name,id:window.DMC.Native.data._id,short_id:window.DMC.Native.data.short_id,page_url:e};return t};v.setGlobalProperties(a)}function r(e){v.addEvent("video_plays",e,function(e,a){e&&console.error("error logging beacon",e)})}function i(){$("#dmc-card-container").addClass("filter-menu-open")}function d(){a()}function o(){$("#card-header").css("position","fixed"),$("#dmc-card-container").removeClass("filter-menu-open"),a()}function n(){$("#card-header").css("position","absolute"),$("#card-list-filter").scrollTop(0);var e=window.innerWidth-70;TweenLite.to($("#card"),.5,{left:e+"px",onStart:i,onComplete:d,ease:Power1.easeOut})}function c(e){e=e||0,$("#dmc-card-container").removeClass("filter"),TweenLite.to($("#card"),.5,{left:"0",delay:e,onComplete:o,ease:Power1.easeOut})}function l(e){$("#card-list .item").hide(),"all"!==e?($('.item[data-category="'+e+'"]').show(),$("#card").scrollTop(0),$("#card-list").scrollTop(0)):$(".item").show(),c(".3")}function s(){window.scrollTo(0,0),a(),$("html, body").addClass("disable-scroll")}function f(){$("#card-detail").scrollTop(0),$("html, body").removeClass("disable-scroll"),$("#card-detail").css("display","none"),a(),$("html body").animate({scrollTop:u},300)}function p(e,a,t,r){if(t?($("#card-footer .apply").show(),$("#card-footer .apply").attr("href",t),$("#card-footer").removeClass("reverse")):($("#card-footer .apply").hide(),$("#card-footer").addClass("reverse")),e){$("#card-footer .share").show();var i=encodeURIComponent(window.DMC.Native.data.publisher+": "+window.DMC.Native.data.headline+", "+e);a||(a=e),r&&(i=encodeURIComponent(r.advertiser+" has an opening for "+r.tagline+"! Check out this video, "+e));var d="https://www.facebook.com/dialog/feed?app_id=484257678295938&display=popup&redirect_uri=";d=d+encodeURIComponent(e)+"&link="+encodeURIComponent(e)+"&caption="+encodeURIComponent(window.DMC.Native.data.publisher+": "+window.DMC.Native.data.headline),$("#card-footer .fb").attr("href",d);var o="https://twitter.com/intent/tweet?text=";o+=i,$("#card-footer .twitter").attr("href",o);var n="sms://&body=";n+=i,$("#card-footer .sms").attr("href",n)}else $("#card-footer .share").hide(),$("#card-footer").addClass("reverse")}var m,v,u=0,w;$("#card-header .filter.category").click(function(e){e.preventDefault(),$("#dmc-card-container").toggleClass("filter"),$("#dmc-card-container").hasClass("filter")?n():c(".3")}),$("#card-header .close-card").click(function(e){e.preventDefault(),window.parent.postMessage("dmc-eject-card","*")}),$("#card-list-filter li").click(function(e){e.preventDefault(),$("#card-list-filter li").removeClass("active"),$(this).addClass("active"),l($(this).data("category"))}),$("#card-header .back").click(function(e){e.preventDefault(),$("#card-header .filter").show(),$("#card-header .back").hide(),document.getElementById("native-video-player").currentTime=0,document.getElementById("native-video-player").pause(),$("#card-footer .apply").hide(),$("#card-footer").addClass("reverse"),p(window.DMC.Native.data.extra.dmc_index_url);var a=window.innerWidth,t=0;TweenLite.to($("#card-detail"),.5,{left:a,delay:t,onComplete:f,ease:Power1.easeOut})}),$("#card-footer a").click(function(e){var a=$(this).data("medium"),t="share_actions";return"Apply"===a&&(t="apply_actions"),v.trackExternalLink(e,t,{creative:m,medium:a})}),$("#card-list .item").click(function(e){if(e.preventDefault(),$("#dmc-card-container").hasClass("filter-menu-open"))return c();var a=$(this).data("id");$.each(DMC.Native.data.creatives_compiled,function(e,t){return t._id===a?(m=t,!1):void 0}),u=document.body.scrollTop,$("#native-video-player").attr("src",m.media.mp4),$("#native-video-player").attr("poster",m.media.logo),$("#card-detail .logo").attr("src",m.media.logo),$("#card-detail .title").text(m.headline),$("#card-detail .tagline").text(m.tagline),$("#card-detail .description").text(m.description),p(m.link.slp,m.link.slp_short,m.link.website,{advertiser:m.advertiser,tagline:m.tagline});var t=0;TweenLite.to($("#card-detail"),.5,{left:"0",display:"block",delay:t,onComplete:s,ease:Power1.easeOut}),$("#card-header .filter").hide(),$("#card-header .back").show();var i={id:m._id,listingID:m.extra.listingID,dmcAdNumber:m.extra.dmcAdNumber,headline:m.headline,tagline:m.tagline,category:m.category,vertical:m.vertical,referrer:document.referrer,keen:{timestamp:(new Date).toISOString()}};r(m)}),e()});