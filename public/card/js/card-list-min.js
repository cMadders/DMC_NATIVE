$(document).ready(function(){function a(){e(),window.DMC.Native.data.creative_count>21?(j(),$("#dmc-card-container").addClass("filter")):l("all"),t=window.DMC.Native.data.extra.dmc_index_url_short||window.DMC.Native.data.extra.dmc_index_url,$("#card-list-filter li").removeClass("active"),$('#card-list-filter li[data-category="all"]').addClass("active"),q(t),b(),window.addEventListener("message",function(a){if(a.data.type&&"dmc-card-message"===a.data.type)switch(a.data.key){case"page_url":v=a.data.value,c(v)}},!1),window.addEventListener("resize",b),window.parent.postMessage("dmc-card-initialized","*"),TweenLite.to($("#dmc-card-container"),.5,{opacity:"1",ease:Power1.easeOut})}function b(){var a=window.innerHeight-109;$("#card-list").css("height",a),$("#card-detail").css("height",a)}function c(a){console.log("initKeenIO",a),s=new Keen({projectId:"56c1264e46f9a71a338f446c",writeKey:"936b2216b15acce7d3dd66337d00f30f57e9fdd9b9456b9a4c1609264c90258fc07bfa0dece818e776f1e541cab23eaa7481c3ace0405cc249b2ed5b22f37d6455057944a18b212a412143b19444f195312d3d038ea2877c4fcb34bc42a17ee3"});var b=function(b){var c={publisher:window.DMC.Native.data.publisher,site:window.DMC.Native.data.site,name:window.DMC.Native.data.name,id:window.DMC.Native.data._id,short_id:window.DMC.Native.data.short_id,page_url:a};return c};s.setGlobalProperties(b)}function d(a){s&&s.addEvent("video_plays",a,function(a,b){a&&console.error("error logging beacon",a)})}function e(){$.get("//widgets.digitalmediacommunications.com/analytics/get_token",function(a){var b=JSON.parse(a);console.log("token",b.hash),w=b.hash})}function f(a,b){var c="http://widgets.digitalmediacommunications.com/analytics/clicks";"apply"==a&&(a="apply_here");var d=[b.toString(),a,"M1","native",window.DMC.Native.data.extra.dmc_publication_id,v];w&&$.ajax({type:"POST",url:c,data:{ci_csrf_token:w,data:JSON.stringify(d)},success:function(a){window.console.log("XUL Analytics Logged Successfully")}})}function g(){$("#dmc-card-container").addClass("filter-menu-open")}function h(){b()}function i(){$("#card-header").css("position","fixed"),$("#dmc-card-container").removeClass("filter-menu-open"),b()}function j(){$("#card-header").css("position","absolute"),$("#card-list-filter").scrollTop(0);var a=window.innerWidth-70;TweenLite.to($("#card"),.5,{left:a+"px",onStart:g,onComplete:h,ease:Power1.easeOut})}function k(a){a=a||0,$("#dmc-card-container").removeClass("filter"),TweenLite.to($("#card"),.5,{left:"0",delay:a,onComplete:i,ease:Power1.easeOut})}function l(a){$("#card-list .item").hide(),"all"!==a?($('.item[data-category="'+a+'"]').show(),$("#card").scrollTop(0),$("#card-list").scrollTop(0)):$(".item").show(),k(".3")}function m(){window.scrollTo(0,0),b(),$("html, body").addClass("disable-scroll")}function n(){$("#card-detail").scrollTop(0),$("html, body").removeClass("disable-scroll"),$("#card-detail").css("display","none"),b(),$("html body").animate({scrollTop:u},300)}function o(){document.getElementById("native-video-player").currentTime=0,document.getElementById("native-video-player").pause(),$("#card-detail .coupon").hide(),$("#card-detail .address").hide(),$("#card-detail .map").hide()}function p(){var a=$("#entry-template").html(),b=Handlebars.compile(a),c=b(r);$("#entryOutput").html(c)}function q(a,b,c,d){if(c?(r.vertical&&"employment"!=r.vertical.toLowerCase()&&$("#card-footer .apply p").text("Visit Website"),$("#card-footer .apply").show(),$("#card-footer .apply").attr("href",c),$("#card-footer").removeClass("reverse")):($("#card-footer .apply").hide(),$("#card-footer").addClass("reverse")),a){$("#card-footer .share").show();var e=encodeURIComponent(window.DMC.Native.data.publisher+": "+window.DMC.Native.data.headline+", "+a);b||(b=a),d&&(e="retail"==r.vertical.toLowerCase()||"real estate"==r.vertical.toLowerCase()?encodeURIComponent("Check out this video from "+d.advertiser+", "+b):encodeURIComponent(d.advertiser+" has an opening for "+d.tagline+"! Check out this video, "+b));var f="https://www.facebook.com/dialog/feed?app_id=484257678295938&display=popup&redirect_uri=";f=f+encodeURIComponent(a)+"&link="+encodeURIComponent(a)+"&caption="+encodeURIComponent(window.DMC.Native.data.publisher+": "+window.DMC.Native.data.headline),$("#card-footer .fb").attr("href",f);var g="https://twitter.com/intent/tweet?text=";g+=e,$("#card-footer .twitter").attr("href",g);var h="sms://&body=";h+=e,$("#card-footer .sms").attr("href",h)}else $("#card-footer .share").hide(),$("#card-footer").addClass("reverse")}var r,s,t,u=0,v="http://www.digitalmediacommunications.com",w="not set";$("#card-header .filter.category").click(function(a){a.preventDefault(),$("#dmc-card-container").toggleClass("filter"),$("#dmc-card-container").hasClass("filter")?j():k(".3")}),$("#card-header .close-card").click(function(a){a.preventDefault(),window.parent.postMessage("dmc-eject-card","*")}),$("#card-list-filter li").click(function(a){a.preventDefault(),$("#card-list-filter li").removeClass("active"),$(this).addClass("active"),l($(this).data("category"))}),$("#card-header .back").click(function(a){a.preventDefault(),o(),$("#card-header .filter").show(),$("#card-header .back").hide(),$("#card-footer .apply").hide(),$("#card-footer").addClass("reverse"),q(t);var b=window.innerWidth,c=0;TweenLite.to($("#card-detail"),.5,{left:b,delay:c,onComplete:n,ease:Power1.easeOut})}),$("#card-footer a").click(function(a){var b=$(this).data("medium"),c="share_actions";return"Apply"===b&&(c="apply_actions"),f(b.toLowerCase(),r.extra.listingID),s?s.trackExternalLink(a,c,{creative:r,medium:b}):void 0}),$("#card-list .item").click(function(a){if(a.preventDefault(),$("#dmc-card-container").hasClass("filter-menu-open"))return k();var b=$(this).data("id");$.each(DMC.Native.data.creatives_compiled,function(a,c){return c._id===b?(r=c,!1):void 0}),u=document.body.scrollTop,p(),q(r.link.slp,r.link.slp_short,r.link.website,{advertiser:r.advertiser,tagline:r.tagline});var c=0;TweenLite.to($("#card-detail"),.5,{left:"0",display:"block",delay:c,onComplete:m,ease:Power1.easeOut}),$("#card-header .filter").hide(),$("#card-header .back").show();var e={id:r._id,listingID:r.extra.listingID,dmcAdNumber:r.extra.dmcAdNumber,headline:r.headline,tagline:r.tagline,category:r.category,vertical:r.vertical,referrer:document.referrer,keen:{timestamp:(new Date).toISOString()}};d(e),f("video_play",e.listingID)}),a()});